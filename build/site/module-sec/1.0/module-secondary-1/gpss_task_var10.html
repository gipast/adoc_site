<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled :: создание демо-сайта Antora</title>
    <link rel="canonical" href="https://example.org/docs/module-sec/1.0/module-secondary-1/gpss_task_var10.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://example.org/docs">создание демо-сайта Antora</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="module-sec" data-version="1.0">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">module-secondary-1 XXX</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="gpss_task_var10.html">Пояснительная записка</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="titul.html">Титульный лист</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Welcome</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">module-secondary-1 XXX</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Component B</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../component-b/2.0/index.html">2.0</a>
        </li>
        <li class="version">
          <a href="../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">module-secondary-1 XXX</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">module-secondary-1 XXX</a></li>
    <li class="crumb"><a href="gpss_task_var10.html">Пояснительная записка</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/gipast/adoc-module-1/edit/master/modules/module-secondary-1/pages/gpss_task_var10.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<!-- toc disabled -->
<div class="sect1">
<h2 id="_задание"><a class="anchor" href="#_задание"></a>Задание</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Вариант 10</p>
</div>
<div class="paragraph">
<p>Имеется пешеходный переход, оснащённый кнопкой.</p>
</div>
<div class="paragraph">
<p>После нажатия на кнопку, через 10 с движение автомобилей запрещается и возможен переход в течение 10 с.</p>
</div>
<div class="paragraph">
<p>Пешеходы, прибывшие менее, чем за 3 с до окончания сигнала, разрешающего переход, остаются на месте. Считается, что они нажмут на кнопку в момент возобновления автомобильного движения.</p>
</div>
<div class="paragraph">
<p>После возобновления движения автомобилей в течение первых 10 с средняя интенсивность проезда составляет 10 машин в минуту (все распределения в данной задаче носят экспоненциальный характер), затем она увеличивается до 50.</p>
</div>
<div class="paragraph">
<p>Интенсивность движения автомобилей – 25 машин в минуту.<br>
Интенсивность прихода пешеходов – 2 человека в минуту.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Промоделировать работу перехода в течение часа.</p>
</li>
<li>
<p>Проанализировать пропускную способность движения автомобилей в районе перехода, оценить:</p>
<div class="ulist">
<ul>
<li>
<p>величину очередей ожидающих проезда автомобилей</p>
</li>
<li>
<p>число ожидающих пешеходов и время их ожидания.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Исследовать модификацию системы, в которой остановка движения автомобилей допускается не чаще, чем раз в 40 с.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_отчет_по_gpss"><a class="anchor" href="#_отчет_по_gpss"></a>Отчет по GPSS</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">;  GPSS/PC Traffic Light Simulation

GENERATE ,,,1
ADVANCE 3600
TERMINATE 1

;GREENTIME EQU        10
;REDTIME EQU          10

PASS_TIME EQU 7
GAP_TIME EQU  3
BTN_PRESSS_DELAY EQU 10

CAR_INTENSE equ 60/25
MAN_INTENSE equ 60/2

wait_time VARIABLE  C1 - X$car_start_time
CarsPassSpeed  FUNCTION wait_time,D2
10,10/11,50

GENERATE 0,0,0,1
LOGIC R man_sem
LOGIC R btn
MARK_HANDLER LOGIC S car_sem
SAVEVALUE car_start_time,C1

GATE LS btn
ADVANCE BTN_PRESSS_DELAY
LOGIC R car_sem
LOGIC S man_sem
LOGIC R btn
ADVANCE PASS_TIME
LOGIC R man_sem
ADVANCE GAP_TIME
TRANSFER ,MARK_HANDLER


GENERATE                MAN_INTENSE;Create people queue
QUEUE q_people

   GATE LS car_sem,CARS_NOT_MOVE
GATE LR btn,CARS_NOT_MOVE
LOGIC S btn ; # PUSH_THE_BUTTON

CARS_NOT_MOVE GATE LS man_sem
PASS_THE_ROAD DEPART q_people
TERMINATE


GENERATE     CAR_INTENSE                ;Create next automobile.
QUEUE q_cars
SEIZE cross
ADVANCE (Exponential(2,0,60/FN$CarsPassSpeed))
GATE LS car_sem
DEPART q_cars
RELEASE cross

TERMINATE; INCOMING CARS

START 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>06/02/19 01:39:17  Model Translation Begun.
06/02/19 01:39:17  Ready.
06/02/19 01:39:17  Simulation in Progress.
06/02/19 01:39:17  The Simulation has ended.  Clock is 3600.000000.
06/02/19 01:39:17  Reporting in ModelText.1.1  -  REPORT Window.</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/report_gpss_var10-58859.png" alt="">
</div>
<div class="title">Рисунок 1: Общая информация</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/report_gpss_var10-653ec.png" alt="">
</div>
<div class="title">Рисунок 2: Имена</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/report_gpss_var10-a491f.png" alt="">
</div>
<div class="title">Рисунок 3: Блоки</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/report_gpss_var10-839f9.png" alt="">
</div>
<div class="title">Рисунок 4: Очереди</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/report_gpss_var10-40901.png" alt="">
</div>
<div class="title">Рисунок 5: Логические переключатели</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_отчет_по_программе_симулятору"><a class="anchor" href="#_отчет_по_программе_симулятору"></a>Отчет по программе-симулятору</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Программа построена на принципе последовательного исполнения действий, помещаемых по ходу действия программы в цепь будущих событий.</p>
</div>
<div class="paragraph">
<p>На каждом этапе исполнения программы из массива хранимых событий извлекается событие с минимальным временем, модельное время обновляется до времени извлеченного события и исполняется действие, ассоциированное с этим событием.</p>
</div>
<div class="paragraph">
<p>Отдельно хранятся состояния элементов модели, которые могут меняться при исполнении программы и влияют на ее поведение.</p>
</div>
<div class="paragraph">
<p>В программе объявлен класс <code>semaphore_w_button</code> методы которого являются основными действиями, меняющими состояние модели,<br>
поток входящих автомобилей и пешеходов реализуется функциями <code>car_generator</code> и <code>people_generator</code>.</p>
</div>
<div class="listingblock">
<div class="title">program.py</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-py hljs" data-lang="py">import os
import sys
import random
from math import log

import matplotlib.pyplot as plt

from sim import Color, semaphore
from sim import Sim as simulation
from sim import queue

simulation_time = 3600

simul = simulation(simulation_time)

car_queue = queue()
man_queue = queue()

def exp_generator(mean):
    return -log(1 - random.random()) * mean


class semaphore_w_button():
    def __init__(self):
        self.button_active = True

        self.car_sem = semaphore(start_color= Color.RED)
        self.people_sem = semaphore(start_color=Color.RED)
        self.press_button_event = None
        self.change_state_time = 0

        self.btn_delay_time = 0

    def press_button(self):
        if sem.button_active == True:
            sem.button_active = False
            simul.new_event(self.allow_people_pass, 10)

    def button_activate(self):
        self.button_active = True

    def deprecate_car_pass(self):
        self.car_sem.value = Color.RED
        simul.new_event(self.button_activate, self.btn_delay_time)

    def allow_people_pass(self):
        self.deprecate_car_pass()
        self.people_sem.value = Color.GREEN

        global man_queue
        man_queue.free(simul.time)

        simul.new_event(self.deprecate_people_pass, 7)
        simul.new_event(self.allow_car_pass, 10)

    def deprecate_people_pass(self):
        self.people_sem.value = Color.RED

    def car_generator_pass(self):
        if self.car_sem.value != Color.GREEN:
            return

        global car_queue
        car_queue.sub(simul.time)

        if simul.time - self.change_state_time &gt; 10:
            mean = 60. / 50.
        else:
            mean = 60. / 10.
        simul.new_event(self.car_generator_pass, exp_generator(mean))

    def allow_car_pass(self):
        if self.people_sem.value == Color.GREEN:
            raise BaseException
        self.car_sem.value = Color.GREEN

        self.change_state_time = simul.time

        simul.new_event(self.car_generator_pass, 0)


sem = semaphore_w_button()

def car_generator():
    simul.new_event(car_generator, exp_generator(60. / 25.))
    global car_queue
    car_queue.add(simul.time)

def people_generator():
    if sem.people_sem.value == Color.RED:
        sem.press_button()

        global man_queue
        man_queue.add(simul.time)

    simul.new_event(people_generator, exp_generator(60. / 2.))


def plot_results():
    fig, axes = plt.subplots(2, 1, figsize=(12, 9), sharex=True)
    fig.set_dpi(100)
    axes[0].plot(car_queue.times, car_queue.vals, linewidth=2.0, linestyle="-")
    axes[0].set_xlabel("time", fontsize=16)
    axes[0].set_ylabel("car queue size", fontsize=16)
    axes[0].grid()

    axes[1].plot(man_queue.times, man_queue.vals, linewidth=2.0, linestyle="-")
    axes[1].set_xlabel("time", fontsize=16)
    axes[1].set_ylabel("man queue", fontsize=16)
    axes[1].grid()


    # axes[0].plot([0, car_queue.time], [car_queue.get_mean_val(),
    #                                    car_queue.get_mean_val()], linewidth=1.0, linestyle="--")
    # axes[1].plot([0, man_queue.time], [man_queue.get_mean_val(),
    #                                    man_queue.get_mean_val()], linewidth=1.0, linestyle="--")

    plt.tight_layout()
    plt.show()

def main():
    sem.btn_delay_time = 100

    car_generator()
    people_generator()

    sem.allow_people_pass()

    while simul.pop_event() != None:
        if simul.time &gt; simul.sim_time:
            break

        # print("time:", simul.time)
        simul.event.action()

    print("mean queue len: ",car_queue.get_mean_val(), man_queue.get_mean_val())

    plot_results()

if __name__ == "__main__":
    main()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">sim.py</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-py hljs" data-lang="py">import os
import sys
import math
import numpy as np

from enum import IntEnum, auto
from itertools import cycle
from operator import attrgetter

class Color(IntEnum):
    _order_ = 'GREEN RED'
    GREEN = 1
    RED = 2


class queue():
    def __init__(self):
        self.size = 0
        self.times = []
        self.vals = []
        self.time = 0
        self.sum = 0

    def plot_update(self, time, next_val):
        self.vals.append(self.size)
        self.times.append(time)
        self.sum += self.size * (time - self.time)

        self.vals.append(next_val)
        self.times.append(time)

        self.time = time
        self.size = next_val

    def add(self, time):
        self.plot_update(time, self.size + 1)

    def sub(self, time):
        if self.size &gt; 0:
            self.plot_update(time, self.size - 1)

    def free(self, time):
        self.plot_update(time, 0)

    def get_mean_val(self):
        return self.sum / self.time


class semaphore():

    colors = ['GREEN', 'RED']

    def __init__(self, start_color=Color.RED):
        self.sem = cycle(enumerate(semaphore.colors, start=start_color))
        self.value = next(self.sem)

    def turn_ligth(self):
        self.value = next(self.sem)
        pass


class sim_event():

    def __init__(self, action, sys_time, time):
        self.time = sys_time + time
        self.action = action


class Sim(sim_event):
    next_evets_queue = []
    time = 0

    def finished(self):
        print("sim done")

    def new_event(self, action, time):
        event = sim_event(action, self.time, time)
        self.next_evets_queue.append(event)

    def __init__(self, sim_time):
        self.sim_time = sim_time
        self.event = sim_event(None, 0, 0)
        self.new_event(self.finished, sim_time)

    def pop_event(self):
        '''
        pops event with min time from queue self.event
        '''
        if len(self.next_evets_queue) == 0:
            return None
        min_val = min(self.next_evets_queue, key=attrgetter('time'))
        minpos = self.next_evets_queue.index(min_val)
        self.event = self.next_evets_queue[minpos]
        self.time = min_val.time

        self.next_evets_queue.remove(self.event)
        return 0

if __name__ == "__main__":
    pass</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_результаты_работы_рограммы"><a class="anchor" href="#_результаты_работы_рограммы"></a>Результаты работы рограммы</h3>
<div class="imageblock">
<div class="content">
<img src="_images/Figure_1.png" alt="">
</div>
<div class="title">Рисунок 6: величины очередей машин и пешеходов</div>
</div>
<div class="paragraph">
<p>На рисунке 6 пунктиром показана средняя средняя длина очереди.</p>
</div>
<div class="sect3">
<h4 id="_исследовать_модификацию_системы_в_которой_остановка_движения_автомобилей_допускается_не_чаще_чем_раз_в_40_с"><a class="anchor" href="#_исследовать_модификацию_системы_в_которой_остановка_движения_автомобилей_допускается_не_чаще_чем_раз_в_40_с"></a>Исследовать модификацию системы, в которой остановка движения автомобилей допускается не чаще, чем раз в 40 с.</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">минимальное время между остановками движения</th>
<th class="tableblock halign-left valign-top">средняя длина очереди автомобилей</th>
<th class="tableblock halign-left valign-top">средняя длина очереди пешеходов</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.210879739656688</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.23339623867578385</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3536987574151538</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.6355950451017411</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
